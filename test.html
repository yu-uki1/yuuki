<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Edler Chatbot mit Key-Eingabe</title>
<style>
body{font-family:Arial;background:#111;color:#fff;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
#login,#chat{width:400px;background:#222;padding:15px;border-radius:10px;display:none;flex-direction:column}
#login{display:flex;flex-direction:column;gap:8px}
#messages{flex:1;overflow-y:auto;margin-bottom:10px;height:300px}
.message{padding:8px;margin:5px 0;border-radius:8px;max-width:80%}
.user{background:#4a90e2;margin-left:auto;text-align:right}
.bot{background:#7b1fa2;margin-right:auto;text-align:left}
#input{display:flex;gap:5px}
input,button{padding:8px;border-radius:5px;border:none}
button{cursor:pointer;background:#4a90e2;color:white}
</style>
</head>
<body>

<div id="login">
  <h3>Gib Deinen OpenAI API-Key ein</h3>
  <input id="key" placeholder="sk-…">
  <button id="start">Start</button>
</div>

<div id="chat">
  <div id="messages"></div>
  <div id="input">
    <input id="text" placeholder="Schreibe mir, edle Yuuki...">
    <button id="send">Senden</button>
  </div>
</div>

<script>
let API_KEY = '';

const loginDiv = document.getElementById('login');
const chatDiv = document.getElementById('chat');
const messages = document.getElementById('messages');
const textInput = document.getElementById('text');
const sendBtn = document.getElementById('send');
const startBtn = document.getElementById('start');

function addMsg(t,cls){const d=document.createElement('div');d.className='message '+cls;d.textContent=t;messages.appendChild(d);messages.scrollTop=messages.scrollHeight;}

startBtn.onclick = () => {
  const k = document.getElementById('key').value.trim();
  if(!k.startsWith('sk-')){alert('Ungültiger Key'); return;}
  API_KEY = k;
  loginDiv.style.display = 'none';
  chatDiv.style.display = 'flex';
};

async function sendMsg(){
  const msg = textInput.value.trim();
  if(!msg) return;
  addMsg(msg,'user');
  textInput.value='';
  addMsg('…','bot');

  try{
    const resp = await fetch('https://api.openai.com/v1/chat/completions',{
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':`Bearer ${API_KEY}`},
      body: JSON.stringify({
        model:"gpt-3.5-turbo",
        messages:[{role:"user",content:msg}]
      })
    });
    const data = await resp.json();
    const botMsgs = document.querySelectorAll('.bot');
    botMsgs[botMsgs.length-1].textContent = data.choices?.[0]?.message?.content || 'Keine Antwort.';
  } catch(e){
    const botMsgs = document.querySelectorAll('.bot');
    botMsgs[botMsgs.length-1].textContent = 'Fehler bei der Anfrage.';
    console.error(e);
  }
}

sendBtn.onclick = sendMsg;
textInput.addEventListener('keydown', e => {if(e.key==='Enter') sendMsg();});
</script>

</body>
</html>
